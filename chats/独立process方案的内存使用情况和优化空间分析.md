## Rust 重写内存估算

### 当前 Python 实现内存分析

```
Python 进程内存构成（约 16.6M/进程）：
├── Python 解释器      ~8-10M  （固定开销）
├── 标准库 + 第三方库   ~4-5M   （asyncio, redis, etc）
└── 实际运行时数据      ~2-3M   （buffer, 状态）
```

### Rust 预估对比

| 架构方案 | 进程数 | 单进程内存 | 总内存 | 对比 Python |
|---------|--------|-----------|--------|-------------|
| **多进程** (保持现有架构) | 49 | 2-4M | **100-200M** | 节省 75-88% |
| **单进程多线程** (推荐) | 1 | 20-40M | **20-40M** | 节省 95-97% |

### 单进程多线程详细估算

```
Rust 单进程内存构成：
├── 二进制 + 运行时        ~3-5M
├── Tokio 异步运行时       ~2-3M
├── Redis 连接池           ~1-2M
├── 48 个端口的数据结构
│   ├── 每端口 buffer      ~64KB × 48 = ~3M
│   ├── 每端口状态         ~1KB × 48  = ~48KB
│   └── PTY/串口句柄       ~2KB × 48  = ~96KB
└── 其他开销               ~5-10M
────────────────────────────────
总计                        ~20-40M
```

### 总结

| 指标 | Python (当前) | Rust (多进程) | Rust (单进程) |
|------|--------------|---------------|---------------|
| 总内存 | **810M** | **~150M** | **~30M** |
| 进程数 | 49 | 49 | 1 |
| 节省比例 | - | ~80% | **~96%** |

**推荐方案**：Rust + 单进程多线程（tokio）

- 内存从 **810M → 30M**（节省约 **96%**）
- 额外好处：启动更快、无 GIL 限制、更低的上下文切换开销

---

### 实现复杂度

如果考虑重写，核心模块大致工作量：

| 模块 | 复杂度 | 说明 |
|------|--------|------|
| frame.rs | 低 | 帧编解码、CRC |
| serial_proxy.rs | 中 | PTY + 串口桥接 |
| db_util.rs | 低 | Redis 交互 |
| dce.rs | 中 | 主控逻辑、线程管理 |

总体约 **1-2 周**工作量（熟悉 Rust 的情况下）。